{% extends "base.html" %}
{% load static %}
{% block content %}

<link rel="stylesheet" type="text/css" href="{% static 'css/order_book.css' %}">

<div class="main-container">
    <!-- First Row -->
    <div class="row first-row">
        <!-- Order Book -->
        <div class="column first-column">
            <h2>Order Book</h2>
            <div class="inner-row-80">
                <table class="order-book">
                    <thead>
                        <tr>
                            <th>Price</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ask in asks %}
                        <tr>
                            <td class="ask">{{ ask.price }}</td>
                            <td class="ask">{{ ask.liquidity }}</td>
                        </tr>
                        {% endfor %}
                        <tr>
                            <td colspan="2" class="spread">Spread: {{ spread }}</td>
                        </tr>
                        {% for bid in bids %}
                        <tr>
                            <td class="bid">{{ bid.price }}</td>
                            <td class="bid">{{ bid.liquidity }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Second Column -->
        <div class="column second-column">
            <!-- Buy/Sell Container -->
            <div class="buy-sell-container">
                <h4>Place an Order</h4>
                <form method="post" action="{% url 'order_management' %}">
                    {% csrf_token %}
                    <div class="order-type-buttons">
                        <input type="radio" id="buy" name="order_type" value="buy" required>
                        <label for="buy" class="btn-buy">Buy</label>
                        <input type="radio" id="sell" name="order_type" value="sell" required>
                        <label for="sell" class="btn-sell">Sell</label>
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label for="price">Price</label>
                            <input
                                type="number"
                                id="price"
                                name="price"
                                step="0.00001"
                                placeholder="Enter price"
                                required
                                oninput="calculateTotal()"
                            >
                        </div>
                        <div class="input-group">
                            <label for="quantity">Quantity</label>
                            <input
                                type="number"
                                id="quantity"
                                name="quantity"
                                step="1"
                                placeholder="Enter quantity"
                                required
                                oninput="calculateTotal()"
                            >
                        </div>
                        <div class="input-group">
                            <label for="total">Total</label>
                            <input
                                type="number"
                                id="total"
                                name="total"
                                placeholder="Total"
                                required
                                readonly
                            >
                        </div>
                    </div>
                    <br>

                    <input type="hidden" name="instrument" value="{{ instrument }}">


                    <button type="submit" class="btn-submit">Place Order</button>
                </form>
                
            </div>
            <br>
            <!-- Transaction History -->
            <div class="transaction-history-container">
                <h4>Transaction History</h4>
                <table class="transaction-history">
                    <thead>
                        <tr>
                            <th>Order Type</th>
                            <th>Instrument</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Filled Quantity</th>
                            <th>Left Quantity</th>
                            <th>Status</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in page_obj %}
                        <tr>
                            <td>{{ order.order_type|title }}</td>
                            <td>{{ order.instrument }}</td>
                            <td>{{ order.price }}</td>
                            <td>{{ order.quantity }}</td>
                            <td>{{ order.filled_quantity }}</td>
                            <td>{{ order.remaining_quantity }}</td>
                            <td>{{ order.status|title }}</td>
                            <td>{{ order.timestamp }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="8" class="no-orders">No orders found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    function calculateTotal() {
        const price = parseFloat(document.getElementById('price').value) || 0;
        const quantity = parseFloat(document.getElementById('quantity').value) || 0;
        const total = price * quantity;
        document.getElementById('total').value = total.toFixed(5); // Display total with 5 decimal points
    }
</script>

{% endblock %}
