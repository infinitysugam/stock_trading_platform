{% extends "base.html" %}
{% load static %}
{% block content %} 
<link rel="stylesheet" type="text/css" href="{% static 'css/order_book.css' %}">


    <h1>Order Book</h1>
    
    <!-- Dropdown for selecting instruments -->
    <form method="get" action="{% url 'order_management' %}">
        <label for="instrument">Select Instrument:</label>
        <select name="instrument" id="instrument" onchange="this.form.submit()">
            <option value="EUR_USD" {% if instrument == "EUR_USD" %}selected{% endif %}>EUR/USD</option>
            <option value="GBP_USD" {% if instrument == "GBP_USD" %}selected{% endif %}>GBP/USD</option>
            <option value="USD_JPY" {% if instrument == "USD_JPY" %}selected{% endif %}>USD/JPY</option>
            <option value="AUD_USD" {% if instrument == "AUD_USD" %}selected{% endif %}>AUD/USD</option>
        </select>
    </form>

    <table>
        <thead>
            <tr>
                <th>Price</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody>
            <!-- Asks at the top -->
            {% for ask in asks %}
            <tr>
                <td class="ask">{{ ask.price }}</td>
                <td class="ask">{{ ask.liquidity }}</td>
            </tr>
            {% endfor %}

            <!-- Spread Row -->
            <tr>
                <td colspan="2" class="spread">Spread: {{ spread }}</td>
            </tr>

            <!-- Bids at the bottom -->
            {% for bid in bids %}
            <tr>
                <td class="bid">{{ bid.price }}</td>
                <td class="bid">{{ bid.liquidity }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>


    <h2>Place an Order</h2>
    <form method="post" action="{% url 'order_management' %}">
        {% csrf_token %}
        <label for="order_type">Order Type:</label>
        <select name="order_type" id="order_type">
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
        </select>
        <br><br>
    
        <label for="price">Price:</label>
        <input type="number" id="price" name="price" step="0.00001" required>
        <br><br>
    
        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" step="1" required>
        <br><br>
    
        <!-- Use the selected instrument dynamically -->
        <input type="hidden" name="instrument" value="{{ instrument }}">
    
        <button type="submit">Place Order</button>
    </form>


    <h2>Transaction History</h2>
<table>
    <thead>
        <tr>
            <th>Order Type</th>
            <th>Instrument</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Filled Quantity</th>
            <th>Left Quantity</th>
            <th>Status</th>
            <th>Timestamp</th>
        </tr>
    </thead>
    <tbody>
        {% for order in page_obj %}
        <tr>
            <td>{{ order.order_type|title }}</td>
            <td>{{ order.instrument }}</td>
            <td>{{ order.price }}</td>
            <td>{{ order.quantity }}</td>
            <td>{{ order.filled_quantity }}</td>
            <td>{{ order.remaining_quantity}}</td>
            <td>{{ order.status|title }}</td>
            <td>{{ order.timestamp }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7" style="text-align: center;">No orders found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination Controls -->
<div style="text-align: center; margin-top: 20px;">
    <span>
        {% if page_obj.has_previous %}
            <a href="?page=1{% if instrument %}&instrument={{ instrument }}{% endif %}">First</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if instrument %}&instrument={{ instrument }}{% endif %}">Previous</a>
        {% endif %}

        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if instrument %}&instrument={{ instrument }}{% endif %}">Next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if instrument %}&instrument={{ instrument }}{% endif %}">Last</a>
        {% endif %}
    </span>
</div>


{% endblock %}